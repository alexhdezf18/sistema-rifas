// server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// MODELO DE LA RIFA
model Raffle {
  id           String   @id @default(uuid())
  name         String
  slug         String   @unique
  description  String
  imageUrl     String?  // <--- Â¡AGREGA ESTA LÃNEA! (El ? significa opcional)
  ticketPrice  Decimal
  totalTickets Int
  startDate    DateTime
  endDate      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tickets      Ticket[]
}

// MODELO DE CLIENTES
model Client {
  id        String   @id @default(uuid())
  name      String
  phone     String   @unique // El telÃ©fono es su identificador clave
  state     String?  // Estado de la repÃºblica (opcional)
  
  createdAt DateTime @default(now())
  
  // RelaciÃ³n: Un cliente puede tener muchos tickets
  tickets   Ticket[]
}

// MODELO DE TICKETS (Solo guardamos los ocupados)
model Ticket {
  id           String       @id @default(uuid())
  ticketNumber Int
  
  // CORRECCIÃ“N AQUÃ: Volvemos a RESERVED porque asÃ­ funciona tu lÃ³gica
  status       TicketStatus @default(RESERVED)

  reservedAt   DateTime     @default(now())
  paidAt       DateTime?

  // ðŸ‘‡ AQUÃ AGREGAMOS EL NUEVO CAMPO
  // Lo ponemos opcional (?) para no romper registros viejos que no tienen estado
  clientState  String?

  // Relaciones
  raffleId     String
  raffle       Raffle       @relation(fields: [raffleId], references: [id], onDelete: Cascade)
  
  clientId     String
  client       Client       @relation(fields: [clientId], references: [id])

  // (Prisma llenarÃ¡ esto automÃ¡tico cuando se cree el registro)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@unique([raffleId, ticketNumber])
}

// ENUM: Solo permitimos estos estados
enum TicketStatus {
  RESERVED  // Apartado (Amarillo)
  PAID      // Pagado (Rojo/Ocupado)
}

// MODELO DE USUARIOS (Administradores)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // AquÃ­ se guardarÃ¡ el hash encriptado
  name      String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Admin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // AquÃ­ guardaremos el hash encriptado, no la contraseÃ±a real
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}