// server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// MODELO DE LA RIFA
model Raffle {
  id           String   @id @default(uuid())
  name         String
  slug         String   @unique
  description  String
  imageUrl     String?  // <--- ¡AGREGA ESTA LÍNEA! (El ? significa opcional)
  ticketPrice  Decimal
  totalTickets Int
  startDate    DateTime
  endDate      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tickets      Ticket[]
}

// MODELO DE CLIENTES
model Client {
  id        String   @id @default(uuid())
  name      String
  phone     String   @unique // El teléfono es su identificador clave
  state     String?  // Estado de la república (opcional)
  
  createdAt DateTime @default(now())
  
  // Relación: Un cliente puede tener muchos tickets
  tickets   Ticket[]
}

// MODELO DE TICKETS (Solo guardamos los ocupados)
model Ticket {
  id           String       @id @default(uuid())
  ticketNumber Int
  
  // CORRECCIÓN AQUÍ: Volvemos a RESERVED porque así funciona tu lógica
  status       TicketStatus @default(RESERVED)

  reservedAt   DateTime     @default(now())
  paidAt       DateTime?

  // Relaciones
  raffleId     String
  raffle       Raffle       @relation(fields: [raffleId], references: [id], onDelete: Cascade)
  
  clientId     String
  client       Client       @relation(fields: [clientId], references: [id])

  // (Prisma llenará esto automático cuando se cree el registro)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@unique([raffleId, ticketNumber])
}

// ENUM: Solo permitimos estos estados
enum TicketStatus {
  RESERVED  // Apartado (Amarillo)
  PAID      // Pagado (Rojo/Ocupado)
}

// MODELO DE USUARIOS (Administradores)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Aquí se guardará el hash encriptado
  name      String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Admin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Aquí guardaremos el hash encriptado, no la contraseña real
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}